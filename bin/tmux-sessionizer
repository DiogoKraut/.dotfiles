#!/usr/bin/bash

PROJECTS="$HOME/AOA"

increase() {
    selected="$1"
    if [ "$selected" = "default" ]
    then
        return 0
    fi
    zoxide add "$PROJECTS/$selected"
}

search() {
    find "$PROJECTS" -maxdepth 1 -type d -printf "%f\n" | \
    while read -r line; do
        echo "$line" "$(zoxide query -s "$line")"
    done | sort -rnk2 | cut -d' ' -f1 | fzf-tmux
}

if [ "$#" -eq 1 ]
then
    selected="$1"
else
    selected=$(search)
fi

if [ -z "$selected" ]
then
    exit 1
fi

selected=$(echo "$selected" | tr '.' '_')

if ! tmux has-session -t "$selected" 2>/dev/null
then
    tmux new-session -d -s "$selected"
fi

increase "$selected"
tmux switch-client -t "$selected"
